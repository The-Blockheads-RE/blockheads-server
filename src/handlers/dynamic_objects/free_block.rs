use crate::handlers::dynamic_objects::{decode_generic_data, DynamicObject};

#[derive(std::fmt::Debug)]
pub struct FreeBlock {
    pub unique_id: i64,
    pub x: i32,
    pub y: i32,

    pub item_type: u16,
    pub data_a: u32,
    pub data_b: u32,
    pub fall_speed: i16,
    pub x_velocity: i16,
    pub y_velocity: i16,
    pub has_subitems: bool,
    pub hovers: bool
}

pub enum ItemType {
    None = 0,
    ClothingSlot = 1,
    DefaultMarker = 2,
    Flint = 3,
    Stick = 4,
    EmptyMarker = 5,
    FlintAxe = 6,
    FlintSpear = 7,
    FlintPickaxe = 8,
    DoubleTime = 9,
    UndefinedC = 10,
    TimeCrystal = 11,
    Basket = 12,
    Ember = 13,
    Charcoal = 14,
    Campfire = 15,
    FlintSpade = 16,
    BasicTorch = 17,
    UndefinedD = 18,
    Blockhead = 19,
    Food = 20,
    Apple = 21,
    Mango = 22,
    MapleSeed = 23,
    PricklyPear = 24,
    FlintMachete = 25,
    UndefinedE = 26,
    PineCone = 27,
    Clay = 28,
    RawDodoMeat = 29,
    DodoFeather = 30,
    CopperOre = 31,
    IronOre = 32,
    StoneAxe = 33,
    StonePickaxe = 34,
    CopperIngot = 35,
    TinOre = 36,
    TinIngot = 37,
    BronzeIngot = 38,
    CopperSpear = 39,
    TinSpade = 40,
    CopperArrow = 41,
    CopperBow = 42,
    BronzePickaxe = 43,
    String = 44,
    ClayJug = 45,
    Coconut = 46,
    ClayLanternLit = 47,
    Oil = 48,
    BronzeMachete = 49,
    BronzeSword = 50,
    Coal = 51,
    Door = 52,
    Ladder = 53,
    FlaxSeed = 54,
    Flax = 55,
    YellowPigment = 56,
    RedPigment = 57,
    Window = 58,
    CookedDodoMeat = 59,
    Orange = 60,
    SunflowerSeed = 61,
    Corn = 62,
    WoodBed = 63,
    StoneSpade = 64,
    IronIngot = 65,
    IronPickaxe = 66,
    IronMachete = 67,
    IronSword = 68,
    Trapdoor = 69,
    IronAxe = 70,
    Carrot = 71,
    GoldIngot = 72,
    GoldOre = 73,
    CarrotStick = 74,
    Ruby = 75,
    Emerald = 76,
    Cherry = 77,
    CoffeeCherry = 78,
    CoffeeBeanGreen = 79,
    EmptyClayCup = 80,
    CoffeeCup = 81,
    RoastedCoffeeBean = 82,
    Linen = 83,
    LinenPants = 84,
    LinenShirt = 85,
    Sapphire = 86,
    Amethyst = 87,
    Diamond = 88,
    GoldSpade = 89,
    GoldPickaxe = 90,
    DodoEgg = 91,
    SteelIngot = 92,
    SteelPickaxe = 93,
    AmethystPickaxe = 94,
    SapphirePickaxe = 95,
    EmeraldPickaxe = 96,
    RubyPickaxe = 97,
    DiamondPickaxe = 98,
    BluePigment = 99,
    BlackPigment = 100,
    WhitePigment = 101,
    TinBucket = 102,
    Paint = 103,
    PaintStripper = 104,
    WaterBucket = 105,
    PigmentGeneric = 106,
    PaintGeneric = 107,
    NoPigment = 108,
    PigmentEmeraldGreen = 109,
    PigmentTyrianPurple = 110,
    Boat = 111,
    Chilli = 112,
    LinenPantsDyedGeneric = 113,
    LinenShirtDyedGeneric = 114,
    LinenCap = 115,
    LinenCapDyedGeneric = 116,
    LinenHat = 117,
    LinenHatDyedGeneric = 118,
    PigmentCopperBlue = 119,
    Leather = 120,
    Fur = 121,
    LeatherJacket = 122,
    LeatherJacketDyedGeneric = 123,
    LeatherBoots = 124,
    LeatherBootsDyedGeneric = 125,
    FurCoat = 126,
    FurBoots = 127,
    FurCoatDyedGeneric = 128,
    FurBootsDyedGeneric = 129,
    LeatherPants = 130,
    LeatherPantsDyedGeneric = 131,
    WorkbenchUpgrade = 132,
    Camera = 133,
    WorkbenchPortal = 134,
    PortalAmethyst = 135,
    PortalSapphire = 136,
    PortalEmerald = 137,
    PortalRuby = 138,
    PortalDiamond = 139,
    FruitHat = 140,
    GrassSkirt = 141,
    SantaHat = 142,
    SouthPoleBoots = 143,
    Kelp = 144,
    AmethystChandelier = 145,
    SapphireChandelier = 146,
    EmeraldChandelier = 147,
    RubyChandelier = 148,
    DiamondChandelier = 149,
    SteelLantern = 150,
    RawFish = 151,
    CookedFish = 152,
    TinFoil = 153,
    TinFoilHat = 154,
    Worm = 155,
    FishingRod = 156,
    SharkJaw = 157,
    FishBucket = 158,
    SharkBucket = 159,
    Lime = 160,
    Shelf = 161,
    Teleport = 162,
    Sign = 163,
    IronDoor = 164,
    IronTrapdoor = 165,
    CopperCoin = 166,
    GoldCoin = 167,
    TradingPost = 168,
    SoftBed = 169,
    GoldBed = 170,
    BedQuiltTexture = 171,
    SoftBedDyedGeneric = 172,
    GoldBedDyedGeneric = 173,
    BlackWindow = 174,
    Magnet = 175,
    CopperBoiler = 176,
    Motor = 177,
    CopperWire = 178,
    SteamEngine = 179,
    Pot = 180,
    FishCurry = 181,
    DodoStew = 182,
    IceTorch = 183,
    SiliconIngot = 184,
    SiliconCrystal = 185,
    SiliconWafer = 186,
    TinPants = 187,
    TinChestPlate = 188,
    TinHelmet = 189,
    TinBoots = 190,
    IronPants = 191,
    IronChestPlate = 192,
    IronHelmet = 193,
    IronBoots = 194,
    IcePants = 195,
    IceChestPlate = 196,
    IceHelmet = 197,
    IceBoots = 198,
    Rail = 199,
    TrainStation = 200,
    PigIron = 201,
    CrushedLimestone = 202,
    TrainWheel = 203,
    Handcar = 204,
    SteamTrain = 205,
    FreightCar = 206,
    DisplayCabinet = 207,
    PassengerCar = 208,
    Crowbar = 209,
    TradePortal = 210,
    GoldChestIndicator = 211,
    PaintingLS = 212,
    PaintingLL = 213,
    PaintingLP = 214,
    PaintingMS = 215,
    PaintingML = 216,
    PaintingMP = 217,
    PaintingSS = 218,
    PaintingSL = 219,
    PaintingSP = 220,
    Easel = 221,
    StoneColumn = 222,
    LimestoneColumn = 223,
    MarbleColumn = 224,
    SandstoneColumn = 225,
    RedMarbleColumn = 226,
    LapisColumn = 227,
    BasaltColumn = 228,
    StoneStairs = 229,
    LimestoneStairs = 230,
    MarbleStairs = 231,
    SandstoneStairs = 232,
    RedMarbleStairs = 233,
    LapisStairs = 234,
    BasaltStairs = 235,
    CopperColumn = 236,
    TinColumn = 237,
    BronzeColumn = 238,
    IronColumn = 239,
    SteelColumn = 240,
    GoldColumn = 241,
    WoodColumn = 242,
    BrickColumn = 243,
    IceColumn = 244,
    CopperStairs = 245,
    TinStairs = 246,
    BronzeStairs = 247,
    IronStairs = 248,
    SteelStairs = 249,
    GoldStairs = 250,
    WoodStairs = 251,
    BrickStairs = 252,
    IceStairs = 253,
    SteelDownlight = 254,
    Poison = 255,
    PoisonArrow = 256,
    PoisonBow = 257,
    SteelUplight = 258,
    WorldCredit = 259,
    PlatinumCoin = 260,
    PlatinumOre = 261,
    PlatinumIngot = 262,
    PlatinumStairs = 263,
    PlatinumColumn = 264,
    GlassStairs = 265,
    GlassColumn = 266,
    BlackGlassStairs = 267,
    BlackGlassColumn = 268,
    Fuel = 269,
    WorkbenchRefinery = 270,
    Epoxy = 271,
    RawResin = 272,
    CarbonFibers = 273,
    CarbonFiberSheet = 274,
    CarbonFiberWing = 275,
    CarbonFiberChassis = 276,
    JetEngine = 277,
    Jetpack = 278,
    TitaniumOre = 279,
    TitaniumIngot = 280,
    TitaniumStairs = 281,
    TitaniumColumn = 282,
    CarbonFiberStairs = 283,
    CarbonFiberColumn = 284,
    TitaniumPickaxe = 285,
    TitaniumSword = 286,
    TitaniumPants = 287,
    TitaniumChestPlate = 288,
    TitaniumHelmet = 289,
    TitaniumBoots = 290,
    CarbonFiberPants = 291,
    CarbonFiberChestPlate = 292,
    CarbonFiberHelmet = 293,
    CarbonFiberBoots = 294,
    Vine = 295,
    TulipBulb = 296,
    TulipSeed = 297,
    Money = 298,
    RandomSluicedOre = 299,
    WorkbenchSluice = 300,
    OwnershipSign = 301,
    Cage = 302,
    DodoCage = 303,
    Gate = 304,
    AmethystShard = 305,
    SapphireShard = 306,
    EmeraldShard = 307,
    RubyShard = 308,
    DiamondShard = 309,
    Wheat = 310,
    Flour = 311,
    Yeast = 312,
    Salt = 313,
    Dough = 314,
    Bread = 315,
    Tomato = 316,
    Pizza = 317,
    Flatbread = 318,
    MilkBucket = 319,
    Mozzarella = 320,
    YakHorn = 321,
    Razor = 322,
    YakShavings = 323,
    DonkeyCage = 324,
    YakCage = 325,
    DropbearCage = 326,
    ScorpionCage = 327,
    RainbowCake = 328,
    RainbowEssence = 329,
    UnicornCage = 330,
    Mirror = 331,
    PlasterColumn = 332,
    PlasterStairs = 333,
    AmethystColumn = 334,
    SapphireColumn = 335,
    EmeraldColumn = 336,
    RubyColumn = 337,
    DiamondColumn = 338,
    AmethystStairs = 339,
    SapphireStairs = 340,
    EmeraldStairs = 341,
    RubyStairs = 342,
    DiamondStairs = 343,
    SpriteItemCount = 344,
    Cobblestone = 1024,
    WorkbenchKiln = 1025,
    RedBricks = 1026,
    Limestone = 1027,
    LimestoneBlock = 1028,
    Marble = 1029,
    MarbleBlock = 1030,
    WorkbenchFurnace = 1031,
    WorkbenchWood = 1032,
    WorkbenchWeave = 1033,
    WorkbenchPress = 1034,
    Sandstone = 1035,
    SandstoneBlock = 1036,
    RedMarble = 1037,
    RedMarbleBlock = 1038,
    FlaxMat = 1039,
    FlaxMatYellow = 1040,
    FlaxMatRed = 1041,
    Glass = 1042,
    Chest = 1043,
    Water = 1044,
    GoldBlock = 1045,
    WorkbenchUpgradeOldUnused = 1046,
    Rock = 1047,
    Dirt = 1048,
    Wood = 1049,
    WorkbenchWorkbench = 1050,
    Sand = 1051,
    WorkbenchTool = 1052,
    Lapis = 1053,
    LapisBlock = 1054,
    WorkbenchCraft = 1055,
    WorkbenchMix = 1056,
    WoodenPlatform = 1057,
    FreezeWater = 1058,
    MeltWater = 1059,
    Ice = 1060,
    WorkbenchDye = 1061,
    Compost = 1062,
    Basalt = 1063,
    BasaltUnmined = 1064,
    Safe = 1065,
    CopperBlock = 1066,
    TinBlock = 1067,
    BronzeBlock = 1068,
    IronBlock = 1069,
    SteelBlock = 1070,
    WorkbenchMetalwork = 1071,
    ChestGold = 1072,
    TradingPostOld = 1073,
    ChestPortal = 1074,
    BlackSand = 1075,
    BlackGlass = 1076,
    SteamGenerator = 1077,
    WorkbenchElectricKiln = 1078,
    WorkbenchElectricFurnace = 1079,
    WorkbenchElectricMetalworkBench = 1080,
    WorkbenchElectricStove = 1081,
    SolarPanel = 1082,
    Flywheel = 1083,
    ArmorBench = 1084,
    TrainYard = 1085,
    WorkbenchBuild = 1086,
    ElevatorShaft = 1087,
    ElevatorMotor = 1088,
    PlatinumBlock = 1089,
    CarbonFiberBlock = 1090,
    TitaniumBlock = 1091,
    GoldCoinTradeForCopperCoins = 1092,
    WorkbenchElectricPress = 1093,
    Gravel = 1094,
    CompostBin = 1095,
    WorkbenchEggExtractor = 1096,
    WorkbenchPizzaOven = 1097,
    AmethystBlock = 1098,
    SapphireBlock = 1099,
    EmeraldBlock = 1100,
    RubyBlock = 1101,
    DiamondBlock = 1102,
    Plaster = 1103,
    ChestFeeder = 1104,
    LuminousPlaster = 1105
}

impl FreeBlock {
    pub fn decode(raw_data: Vec<u8>) -> Self {
        let specific_data = raw_data[32..].to_vec();
        let generic_data = decode_generic_data(raw_data);

        return FreeBlock {
            unique_id: generic_data.unique_id,
            x: generic_data.x,
            y: generic_data.y,
            
            item_type: u16::from_le_bytes([specific_data[0], specific_data[1]]),
            data_a: u32::from_le_bytes([specific_data[2], specific_data[3], specific_data[4], specific_data[5]]),
            data_b: u32::from_le_bytes([specific_data[6], specific_data[7], specific_data[8], specific_data[9]]),
            fall_speed: i16::from_le_bytes([specific_data[8], specific_data[9]]),
            x_velocity: i16::from_le_bytes([specific_data[10], specific_data[11]]),
            y_velocity: i16::from_le_bytes([specific_data[12], specific_data[13]]),
            has_subitems: specific_data[14] != 0,
            hovers: specific_data[15] != 0
        };
    }
}

impl DynamicObject for FreeBlock {
    fn get_unique_id(&self) -> i64 { return self.unique_id; }
    fn get_x(&self) -> i32 {
        return self.x;
    }
    fn get_y(&self) -> i32 {
        return self.y;
    }
    fn encode_obj(&self) -> Vec<u8> {
        let mut encoded_data = Vec::new();

        let mut item_type_bytes = self.item_type.to_le_bytes().to_vec();
        let mut data_a_bytes = self.data_a.to_le_bytes().to_vec();
        let mut data_b_bytes = self.data_b.to_le_bytes().to_vec();
        let mut fall_speed_bytes = self.fall_speed.to_le_bytes().to_vec();
        let mut x_velocity = self.x_velocity.to_le_bytes().to_vec();
        let mut y_velocity = self.y_velocity.to_le_bytes().to_vec();

        encoded_data.append(&mut item_type_bytes);
        encoded_data.append(&mut data_a_bytes);
        encoded_data.append(&mut data_b_bytes);
        encoded_data.append(&mut fall_speed_bytes);
        encoded_data.append(&mut x_velocity);
        encoded_data.append(&mut y_velocity);

        encoded_data.insert(encoded_data.len(), self.has_subitems as u8);
        encoded_data.insert(encoded_data.len(), self.hovers as u8);

        let mut extra_unknown = [0,0,0,0,0,0].to_vec();
        encoded_data.append(&mut extra_unknown);

        return encoded_data;
    }
    fn get_type_id(&self) -> u8 { return 14; }
}